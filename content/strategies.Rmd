---
exclude_jquery: false
#title: Strategies
menu: main
---

```{r, include=FALSE}
library(tidyverse)
library(readxl)
library(here)

knitr::opts_chunk$set(echo=FALSE, message = FALSE, warning = FALSE)

strategy_data <- read_csv(here("data", "strategy-types.csv")) %>% 
  filter(include == "y")

strategy_types <- strategy_data$category %>% unique()

strategies_details <- read_csv(here("data", "strategy-tools.csv"))
```



<div class="strategy-page">

::: {.row}

::: {.col-sm-2}
<nav id="toc" data-toggle="toc" class="sticky-top"></nav>
:::

::: {.col-sm-10}
<h2>Filter by device & browser</h2>

::: {.row .tool-filters}

```{r, results='asis'}
checkbox_content <- tribble(
  ~type,                  ~label,   ~function_name,     ~tag,
  "Laptop",               "Mac",      "toggleMac",     "mac",
  "Laptop",                "PC",       "togglePC",      "pc",
  "Smartphone",       "Android",  "toggleAndroid", "android",
  "Smartphone", "iPhone / iPad",      "toggleIOS",     "ios",
  "Browser",           "Chrome",   "toggleChrome",  "chrome",
  "Browser",          "Firefox",  "toggleFirefox", "firefox",
  "Browser",           "Safari",   "toggleSafari",   "safari"
)

generate_inputs <- function(label, function_name, tag){
  cat(str_c('<input type="checkbox" onclick="', function_name, '()" id="device-', tag, '" name="device-', tag, '" value="', label, '" checked="checked">'))
  cat(str_c('<label for="device-', tag, '">', label, '</label><br>'))
}

generate_functions <- function(function_name, tag){
  cat(str_c('function ', function_name, '() { $(".strategy-tool.', tag, '").toggleClass("', tag, '-show");}'))
}

generate_checkbox <- function(device_type){
  current_checkbox <- checkbox_content %>% 
    filter(type == device_type)
  
  cat('<div class="col-sm-2">')
  cat(str_c('<h4>', device_type, '</h4>'))
  current_checkbox %>% 
    select(label, function_name, tag) %>% 
    pwalk(generate_inputs)
  cat('</div>')
  
  # create the toggle functions
  cat('<script>')
  current_checkbox %>% 
    select(function_name, tag) %>% 
    pwalk(generate_functions)
  cat('</script>')
}

# generate it
checkbox_content$type %>% 
  unique() %>% 
  walk(generate_checkbox)
```

<!-- end tool filters row -->
:::


```{r, results='asis', echo=FALSE, message=FALSE}
# function for generating information about detailed tools
generate_strategy_tools <- function(devices, show_classes, title, illustration, description, link, link_text){
  
  labels_to_apply <- tibble(
    devices_labels = devices
  ) %>% 
    mutate(tag = str_split(devices, " ")) %>% 
    unnest(cols = c(tag)) %>% 
    left_join(checkbox_content %>% select(tag, label, type)) %>% 
    mutate(label = case_when(
      type == "Laptop" ~ str_c('<span class="tool-label-laptop">', label, '</span>'),
      type == "Smartphone" ~ str_c('<span class="tool-label-smartphone">', label, '</span>'),
      type == "Browser" ~ str_c('<span class="tool-label-browser">', label, '</span>')
    )) %>% 
    pull(label) %>% 
    str_c(collapse = "<br>")
  
  cat(str_c('<div class="row strategy-tool ', devices, ' ', show_classes, '">'))
  
  cat('<div class="col-sm-3">')
  cat(str_c('<h5 class="tool-title">', title, '</h5>'))
  cat(str_c('<p class="devices">', labels_to_apply, '</p>'))
  cat("</div>")
  
  cat('<div class="col-sm-6">')
  cat(str_c("<p>", description, "</p>"))
  cat(str_c('<a target="_blank" href="', link, '" class="btn btn-primary" role="button">', link_text, '</a>'))
  cat("</div>")
  
  cat('<div class="col-sm-3">')
  cat(str_c('<img src="', illustration, '" class="img-fluid"/>'))
  #cat('<div class="embed-responsive embed-responsive-16by9">')
  #cat(str_c('<iframe class="embed-responsive-item featured-work-graphic" src="', embed_link, '" allowfullscreen></iframe>'))
  #cat("</div>")
  cat("</div>")
  
  cat("</div>")
}

# function for generating overall types
generate_strategy_types <- function(category, strategy, illustration, illustration_position, description){
  clean_category <- janitor::make_clean_names(category)
  clean_strategy <- janitor::make_clean_names(strategy)
  
  cat(str_c('<div id="', clean_strategy, '" class="col-sm-3 strategy-type ', clean_strategy, '" onclick="highlightStrategy', clean_strategy, '()" data-toggle="collapse" data-target=".multi-collapse-', clean_strategy, '">'))
  cat("<div class='card'>")
  cat(str_c('<img class="card-img-top" src="', illustration, '" style="object-position: ', illustration_position, ';" alt="Card image cap">'))
  cat("<div class='card-body'>")
  cat(str_c('<h5 class="card-title">', strategy, '</h5>'))
  cat(str_c('<p class="card-text">', description, '</p>'))
  cat(str_c('<button class="btn btn-primary" type="button" data-toggle="collapse" data-target=".multi-collapse-', clean_strategy, '">Show me how</button>'))
  cat("</div>")
  cat("</div>")
  cat(str_c('<div class="arrow ', clean_category, ' ', clean_strategy, '"></div>')) #draw arrow
  cat("</div>")
  
  cat(str_c('<div class="collapse multi-collapse-', clean_strategy, ' ', clean_category, ' strategy-type-tools">'))
  strategies_details %>% 
    filter(actual_strategy == strategy) %>% 
    # a longwinded way of adding -show to classes
    mutate(id = row_number()) %>% 
    mutate(show_classes = str_split(devices, " ")) %>% 
    unnest(cols = c(show_classes)) %>% 
    mutate(show_classes = str_c(show_classes, "-show")) %>% 
    group_by(id) %>% 
    mutate(show_classes = str_c(show_classes, collapse = " ")) %>% 
    distinct() %>% 
    ungroup() %>% 
    select(devices, show_classes, title, illustration, description, link, link_text) %>%
    pwalk(generate_strategy_tools)
  cat("</div>")
}

generate_strategy_views <- function(a_strategy_type){
  clean_strategy_type <- janitor::make_clean_names(a_strategy_type)
  
  current_data <- strategy_data %>% 
    filter(category == a_strategy_type) %>% 
    select(category, strategy, illustration, illustration_position, description)
  
  cat(str_c('<div class="row strategy-class ', clean_strategy_type, '">'))
  cat("<div class='col-sm-12'>")
  cat(str_c("<h1>", a_strategy_type, "</h1>"))
  cat("</div>")
  
  pmap(current_data, generate_strategy_types)
  
  # close project row
  cat("</div>")
}

walk(strategy_types, generate_strategy_views)

```


:::
:::


<!-- end strategy page -->
</div>


```{r, results='asis'}
generate_highlight_functions <- function(strategy){
  clean_strategy <- janitor::make_clean_names(strategy)
  
  cat(str_c('function highlightStrategy', clean_strategy, '() { $(".strategy-type.', clean_strategy, '").toggleClass("highlight-this"); $(".arrow.', clean_strategy, '").toggleClass("highlight-this");}\n'))
}

cat("<script>")
walk(strategy_data$strategy, generate_highlight_functions)
cat("</script>")
```


